class: first
layout:false

.absolute.left10.right30.top8[

# ะะพะดัะพะดั ะบ ะฟะพัััะพะตะฝะธั ะฟัะธะปะพะถะตะฝะธะน ะฝะฐ Tarantool

## ะะปะฐะดะธะผะธั ะะตัะตะฟะตะปะธัะฐ
## Mail.ru Cloud Solutions
]

---

class: first
layout:false

.absolute.left10.right30.top8[

# ะะพะดัะพะดั ะบ ะฟะพัััะพะตะฝะธั ะฟัะธะปะพะถะตะฝะธะน ะฝะฐ Tarantool

## Mons Anderson
## Mail.ru Cloud Solutions
]

???

# ะัััะฟะปะตะฝะธะต: ัะตะผ ะผั ะทะฐะฝะธะผะฐะตะผัั


---
layout:true
.footer[
   .mcslogo.absolute.top00.bottom00[
      ![](style/mcs.svg)
   ]
   .absolute.left20.top0[
      mons.github.io/t-conf-app
   ]
]

---

# ะงะตะผ ะผั ะทะฐะฝะธะผะฐะตะผัั?

???

# ะะตะปะฐะตะผ ะฟัะธะปะพะถะตะฝะธั ะฝะฐ Tarantool ะฒ Mail.ru

---

# ะงะตะผ ะผั ะทะฐะฝะธะผะฐะตะผัั?

* ะะตะปะฐะตะผ ะฟัะธะปะพะถะตะฝะธั ะฝะฐ Tarantool ะฒ Mail.ru

???

# 6 ะปะตั

---

# ะงะตะผ ะผั ะทะฐะฝะธะผะฐะตะผัั?

* ะะตะปะฐะตะผ ะฟัะธะปะพะถะตะฝะธั ะฝะฐ Tarantool ะฒ Mail.ru

* 6 ะปะตั

???

# ะะฑะปะฐะบะพ Mail.ru

---

# ะงะตะผ ะผั ะทะฐะฝะธะผะฐะตะผัั?

* ะะตะปะฐะตะผ ะฟัะธะปะพะถะตะฝะธั ะฝะฐ Tarantool ะฒ Mail.ru

* 6 ะปะตั

* ะะฑะปะฐะบะพ Mail.ru

???

# Mail.ru Cloud Solutions

---

# ะงะตะผ ะผั ะทะฐะฝะธะผะฐะตะผัั?

* ะะตะปะฐะตะผ ะฟัะธะปะพะถะตะฝะธั ะฝะฐ Tarantool ะฒ Mail.ru

* 6 ะปะตั

* ะะฑะปะฐะบะพ Mail.ru

* Mail.ru Cloud Solutions

???

# ะั 1.4 ะดะพ 1.10+

---

# ะงะตะผ ะผั ะทะฐะฝะธะผะฐะตะผัั?

* ะะตะปะฐะตะผ ะฟัะธะปะพะถะตะฝะธั ะฝะฐ Tarantool ะฒ Mail.ru

* 6 ะปะตั

* ะะฑะปะฐะบะพ Mail.ru

* Mail.ru Cloud Solutions

* ะั 1.4 ะดะพ 1.10+

???

# ๐ฉ

---

# ะงะตะผ ะผั ะทะฐะฝะธะผะฐะตะผัั?

* ะะตะปะฐะตะผ ะฟัะธะปะพะถะตะฝะธั ะฝะฐ Tarantool ะฒ Mail.ru

* 6 ะปะตั

* ะะฑะปะฐะบะพ Mail.ru

* Mail.ru Cloud Solutions

* ะั 1.4 ะดะพ 1.10+

* ะะฐะตะปะธัั ๐ฉ

???

# ะงัะพ ะผั ัะดะตะปะฐะปะธ

---

# ะงัะพ ะผั ัะดะตะปะฐะปะธ ะฝะฐ ะฑะฐะทะต Tarantool?

???

# Key-value ั ัะบัะฟะฐะนัะพะผ (ะผะตะผะบัั)

---

# ะงัะพ ะผั ัะดะตะปะฐะปะธ ะฝะฐ ะฑะฐะทะต Tarantool?

* Key-value ั ัะบัะฟะธัะฐัะธะตะน

???

# ะะตัะธััััะธะต ะฟัะพะบัะธ ะบ SQL


---

# ะงัะพ ะผั ัะดะตะปะฐะปะธ ะฝะฐ ะฑะฐะทะต Tarantool?

* Key-value ั ัะบัะฟะธัะฐัะธะตะน

* ะะตัะธััััะธะต ะฟัะพะบัะธ ะบ SQL

???

# ะัะตัะตะดะธ

---

# ะงัะพ ะผั ัะดะตะปะฐะปะธ ะฝะฐ ะฑะฐะทะต Tarantool?

* Key-value ั ัะบัะฟะธัะฐัะธะตะน

* ะะตัะธััััะธะต ะฟัะพะบัะธ ะบ SQL

* ะัะตัะตะดะธ

???

# ะัะตะฝั ัะฐะทะฝัะต ะพัะตัะตะดะธ

---

# ะงัะพ ะผั ัะดะตะปะฐะปะธ ะฝะฐ ะฑะฐะทะต Tarantool?

* Key-value ั ัะบัะฟะธัะฐัะธะตะน

* ะะตัะธััััะธะต ะฟัะพะบัะธ ะบ SQL

* ะัะตัะตะดะธ

* ะัะตะฝั ัะฐะทะฝัะต ะพัะตัะตะดะธ

???

# ะจะฐัะดะธัะพะฒะฐะฝะฝัะต ะบะปะฐััะตัะฐ

---

# ะงัะพ ะผั ัะดะตะปะฐะปะธ ะฝะฐ ะฑะฐะทะต Tarantool?

* Key-value ั ัะบัะฟะธัะฐัะธะตะน

* ะะตัะธััััะธะต ะฟัะพะบัะธ ะบ SQL

* ะัะตัะตะดะธ

* ะัะตะฝั ัะฐะทะฝัะต ะพัะตัะตะดะธ

* ะจะฐัะดะธัะพะฒะฐะฝะฝัะต ะบะปะฐััะตัะฐ

???

# ะัะปััะธะผะฐััะตั ะบะปะฐััะตั

---

# ะงัะพ ะผั ัะดะตะปะฐะปะธ ะฝะฐ ะฑะฐะทะต Tarantool?

* Key-value ั ัะบัะฟะธัะฐัะธะตะน

* ะะตัะธััััะธะต ะฟัะพะบัะธ ะบ SQL

* ะัะตัะตะดะธ

* ะัะตะฝั ัะฐะทะฝัะต ะพัะตัะตะดะธ

* ะจะฐัะดะธัะพะฒะฐะฝะฝัะต ะบะปะฐััะตัะฐ

* ะัะปััะธะผะฐััะตั ะบะปะฐััะตั

???

# 3 ะฑะธะปะปะธะฝะณะฐ

---

# ะงัะพ ะผั ัะดะตะปะฐะปะธ ะฝะฐ ะฑะฐะทะต Tarantool?

* Key-value ั ัะบัะฟะธัะฐัะธะตะน

* ะะตัะธััััะธะต ะฟัะพะบัะธ ะบ SQL

* ะัะตัะตะดะธ

* ะัะตะฝั ัะฐะทะฝัะต ะพัะตัะตะดะธ

* ะจะฐัะดะธัะพะฒะฐะฝะฝัะต ะบะปะฐััะตัะฐ

* ะัะปััะธะผะฐััะตั ะบะปะฐััะตั

* ะะธะปะปะธะฝะณะธ

???

# ะะตะนั-ะปะธะผะธัะตั

---

# ะงัะพ ะผั ัะดะตะปะฐะปะธ ะฝะฐ ะฑะฐะทะต Tarantool?

* Key-value ั ัะบัะฟะธัะฐัะธะตะน

* ะะตัะธััััะธะต ะฟัะพะบัะธ ะบ SQL

* ะัะตัะตะดะธ

* ะัะตะฝั ัะฐะทะฝัะต ะพัะตัะตะดะธ

* ะจะฐัะดะธัะพะฒะฐะฝะฝัะต ะบะปะฐััะตัะฐ

* ะัะปััะธะผะฐััะตั ะบะปะฐััะตั

* ะะธะปะปะธะฝะณะธ

* ะะตะนั-ะปะธะผะธัะตั

???

# ะกะปะพะถะฝะพ ะฟะพะฒะตัะธัั โ ะบะฐะบ ัะตะปััะธะพะฝะฝัั ะะ

---

# ะงัะพ ะผั ัะดะตะปะฐะปะธ ะฝะฐ ะฑะฐะทะต Tarantool?

* Key-value ั ัะบัะฟะธัะฐัะธะตะน

* ะะตัะธััััะธะต ะฟัะพะบัะธ ะบ SQL

* ะัะตัะตะดะธ

* ะัะตะฝั ัะฐะทะฝัะต ะพัะตัะตะดะธ

* ะจะฐัะดะธัะพะฒะฐะฝะฝัะต ะบะปะฐััะตัะฐ

* ะัะปััะธะผะฐััะตั ะบะปะฐััะตั

* ะะธะปะปะธะฝะณะธ

* ะะตะนั-ะปะธะผะธัะตั

* ะัะพััะพ ะธัะฟะพะปัะทะพะฒะฐะปะธ ะบะฐะบ ัะตะปััะธะพะฝะฝัั ะฑะฐะทั ะดะฐะฝะฝัั :)

???

# ะะพะบัะผะตะฝัะฐัะธั ะณะพะฒะพัะธั: ัะฐัะฐะฝััะป โ ะะ

---

# tarantool.io/doc:

* Tarantool โ ะฑะฐะทะฐ ะดะฐะฝะฝัั

???

# ะ ะตัั โ ัะตัะฒะตั ะฟัะธะปะพะถะตะฝะธะน

---

# tarantool.io/doc:

* Tarantool โ ะฑะฐะทะฐ ะดะฐะฝะฝัั

* _Tarantool โ ัะตัะฒะตั ะฟัะธะปะพะถะตะฝะธะน_

???

# ะ ะบะฐะบ ะตะณะพ ะณะพัะพะฒะธัั?

---

# tarantool.io/doc:

* Tarantool โ ะฑะฐะทะฐ ะดะฐะฝะฝัั

* _Tarantool โ ัะตัะฒะตั ะฟัะธะปะพะถะตะฝะธะน_

.center[
# ะบะฐะบ?
]

???

# ะงัะพ ะฝัะถะฝะพ ะดะปั ัะบัะฟะปัะฐัะฐัะธะธ?

---

# ะญะบัะฟะปัะฐัะฐัะธั ะฟัะธะปะพะถะตะฝะธั

???

# ะะพััะฐะฒะบะฐ ะบะพะดะฐ

---

# ะญะบัะฟะปัะฐัะฐัะธั ะฟัะธะปะพะถะตะฝะธั

* ะะพััะฐะฒะบะฐ ะบะพะดะฐ

???

# ะะฑะฝะพะฒะปะตะฝะธะต

---

# ะญะบัะฟะปัะฐัะฐัะธั ะฟัะธะปะพะถะตะฝะธั

* ะะพััะฐะฒะบะฐ ะบะพะดะฐ

* ะะฑะฝะพะฒะปะตะฝะธะต

???

# ะะพะฝัะธะณััะฐัะธั

---

# ะญะบัะฟะปัะฐัะฐัะธั ะฟัะธะปะพะถะตะฝะธั

* ะะพััะฐะฒะบะฐ ะบะพะดะฐ

* ะะฑะฝะพะฒะปะตะฝะธะต

* ะะพะฝัะธะณััะฐัะธั

???

# ะะฑัะฐัะฝะฐั ัะพะฒะผะตััะธะผะพััั

---

# ะญะบัะฟะปัะฐัะฐัะธั ะฟัะธะปะพะถะตะฝะธั

* ะะพััะฐะฒะบะฐ ะบะพะดะฐ

* ะะฑะฝะพะฒะปะตะฝะธะต

* ะะพะฝัะธะณััะฐัะธั

* ะะฑัะฐัะฝะฐั ัะพะฒะผะตััะธะผะพััั

???

# ะะฐัะต ััะฐะฝะดะฐััะฝะพะต ัะตัะตะฝะธะต

---

# ะะฐัะต ััะฐะฝะดะฐััะฝะพะต ะฟัะธะปะพะถะตะฝะธะต (ัะฝะฐััะถะธ)

???

# ะะฟัะตะดะตะปัะฝะฝัะน layout
# (like LSB)

---

# ะะฐัะต ััะฐะฝะดะฐััะฝะพะต ะฟัะธะปะพะถะตะฝะธะต (ัะฝะฐััะถะธ)

* ะะฐะทะธััะตััั ะฝะฐ baselayout

???

# ะะฑัะตะฝะธะต ัะพะปัะบะพ ะฟะพ iproto
# (msgpack)

---

# ะะฐัะต ััะฐะฝะดะฐััะฝะพะต ะฟัะธะปะพะถะตะฝะธะต (ัะฝะฐััะถะธ)

* ะะฐะทะธััะตััั ะฝะฐ baselayout

* ะะฑัะตะฝะธะต ั ัะฐัะฐะฝััะปะพะผ โ ะฟะพ iproto

???

# ะ ัะฐัะฐะฝััะป ัะพะดะธะผ ะธะท nginx

---

# ะะฐัะต ััะฐะฝะดะฐััะฝะพะต ะฟัะธะปะพะถะตะฝะธะต (ัะฝะฐััะถะธ)

* ะะฐะทะธััะตััั ะฝะฐ baselayout

* ะะฑัะตะฝะธะต ั ัะฐัะฐะฝััะปะพะผ โ ะฟะพ iproto

* Nginx โ Tarantool

???

# ะฐ ัะฐะบะถะต ะธะท ัะฐะทะปะธัะฝัั ะดะตะผะพะฝะพะฒ

---

# ะะฐัะต ััะฐะฝะดะฐััะฝะพะต ะฟัะธะปะพะถะตะฝะธะต (ัะฝะฐััะถะธ)

* ะะฐะทะธััะตััั ะฝะฐ baselayout

* ะะฑัะตะฝะธะต ั ัะฐัะฐะฝััะปะพะผ โ ะฟะพ iproto

* Nginx โ Tarantool

* (Perl/Go/&hellip;) โ Tarantool

???

# Tarantool โ Tarantool (net.box)

---

# ะะฐัะต ััะฐะฝะดะฐััะฝะพะต ะฟัะธะปะพะถะตะฝะธะต (ัะฝะฐััะถะธ)

* ะะฐะทะธััะตััั ะฝะฐ baselayout

* ะะฑัะตะฝะธะต ั ัะฐัะฐะฝััะปะพะผ โ ะฟะพ iproto

* Nginx โ Tarantool

* (Perl/Go/&hellip;) โ Tarantool

* &hellip; โ Tarantool (Balancer) โ Tarantool (Sharder) โ Tarantool โ &hellip;

???

# ะะฐะถะต ะตััั ัะฝะธะฒะตััะฐะปัะฝะฐั ะฟัะพะบัะธ

---

# ะะฐัะต ััะฐะฝะดะฐััะฝะพะต ะฟัะธะปะพะถะตะฝะธะต (ัะฝะฐััะถะธ)

* ะะฐะทะธััะตััั ะฝะฐ baselayout

* ะะฑัะตะฝะธะต ั ัะฐัะฐะฝััะปะพะผ โ ะฟะพ iproto

* Nginx โ Tarantool

* (Perl/Go/&hellip;) โ Tarantool

* &hellip; โ Tarantool (Balancer) โ Tarantool (Sharder) โ Tarantool โ &hellip;

* ะฃะฝะธะฒะตััะฐะปัะฝะฐั ะฟัะพะบัะธ: moonlibs/apex

???

# ะ ััะพ ะฒะฝัััะธ?

---

# ะะฐัะต ััะฐะฝะดะฐััะฝะพะต ะฟัะธะปะพะถะตะฝะธะต (ะฒะฝัััะธ)

???

# ะขะพะปัะบะพ iproto CALL

---

# ะะฐัะต ััะฐะฝะดะฐััะฝะพะต ะฟัะธะปะพะถะตะฝะธะต (ะฒะฝัััะธ)

* ะขะพะปัะบะพ CALL

???

# API wrapper

---

# ะะฐัะต ััะฐะฝะดะฐััะฝะพะต ะฟัะธะปะพะถะตะฝะธะต (ะฒะฝัััะธ)

* ะขะพะปัะบะพ CALL

* ะขะพัะบะฐ ะฒัะพะดะฐ โ API wrapper

???

# ะะตัะตัะฒะฐั ะพัะธะฑะพะบ ะฒะพ ะฒัะฐะฟะฟะตัะต
# (pcall/xpcall)

---

# ะะฐัะต ััะฐะฝะดะฐััะฝะพะต ะฟัะธะปะพะถะตะฝะธะต (ะฒะฝัััะธ)

* ะขะพะปัะบะพ CALL

* ะขะพัะบะฐ ะฒัะพะดะฐ โ API wrapper

* ะะตัะตัะฒะฐั ะพัะธะฑะพะบ

???

# ะัะธะฝััะพะฝ โ ะบะพะฝัะตะบัั

---

# ะะฐัะต ััะฐะฝะดะฐััะฝะพะต ะฟัะธะปะพะถะตะฝะธะต (ะฒะฝัััะธ)

* ะขะพะปัะบะพ CALL

* ะขะพัะบะฐ ะฒัะพะดะฐ โ API wrapper

* ะะตัะตัะฒะฐั ะพัะธะฑะพะบ

* ะะฑัะตะบั ะบะพะฝัะตะบััะฐ (moonlibs/ctx)

???

# request-id (ctx)
# tracing

---

# ะะฐัะต ััะฐะฝะดะฐััะฝะพะต ะฟัะธะปะพะถะตะฝะธะต (ะฒะฝัััะธ)

* ะขะพะปัะบะพ CALL

* ะขะพัะบะฐ ะฒัะพะดะฐ โ API wrapper

* ะะตัะตัะฒะฐั ะพัะธะฑะพะบ

* ะะฑัะตะบั ะบะพะฝัะตะบััะฐ (moonlibs/ctx)

* ะัะพะฑัะพั ะธะปะธ ะณะตะฝะตัะฐัะธั request-id (tracing)

???

# ะะพะณะณะธัะพะฒะฐะฝะธะต + req-id

---

# ะะฐัะต ััะฐะฝะดะฐััะฝะพะต ะฟัะธะปะพะถะตะฝะธะต (ะฒะฝัััะธ)

* ะขะพะปัะบะพ CALL

* ะขะพัะบะฐ ะฒัะพะดะฐ โ API wrapper

* ะะตัะตัะฒะฐั ะพัะธะฑะพะบ

* ะะฑัะตะบั ะบะพะฝัะตะบััะฐ (moonlibs/ctx)

* ะัะพะฑัะพั ะธะปะธ ะณะตะฝะตัะฐัะธั request-id (tracing)

* ะะพะณะณะธัะพะฒะฐะฝะธะต

???

# "HTTP"-ััะธะปั

---

# ะะฐัะต ััะฐะฝะดะฐััะฝะพะต ะฟัะธะปะพะถะตะฝะธะต (ะฒะฝัััะธ)

* ะขะพะปัะบะพ CALL

* ะขะพัะบะฐ ะฒัะพะดะฐ โ API wrapper

* ะะตัะตัะฒะฐั ะพัะธะฑะพะบ

* ะะฑัะตะบั ะบะพะฝัะตะบััะฐ (moonlibs/ctx)

* ะัะพะฑัะพั ะธะปะธ ะณะตะฝะตัะฐัะธั request-id (tracing)

* ะะพะณะณะธัะพะฒะฐะฝะธะต

* "HTTP" ััะธะปั ะฒะพะทะฒัะฐัะฐ

```lua
return box.tuple.new{ 200, {...} }
return box.tuple.new{ 500, {...} }
```

???

# ะงัะพ ะฝะฐัััั ัะฐัะดะธะฝะณะฐ?

---

# ะจะฐัะดะธะฝะณ?

???

# ะกะฒะพะน

--

* ะกะฒะพะน

--

* v1

--

* v2

--

* v3

--

* &hellip;

???

# ะธะฝะพะณะดะฐ vshard

--

* tarantool/vshard

???

# >> baselayout

---

# Baselayout

???

# ะฃะฝะธัะธัะธัะพะฒะฐะฝะฝัะน ะฟะพะดัะพะด
* ัะฐะทัะฐะฑะพัะบะฐ
* ะฟัะพะดะฐะบัะฝ

---

# Baselayout

* ะฃะฝะธัะธัะธัะพะฒะฐะฝะฝัะน ะฟะพะดัะพะด ะบ ะทะฐะฟััะบั
   - nodetach
   - tarantoolctl (local)
   - init.d
   - systemd

???

# ะะฐะฒะธัะธะผะพััะธ

---

# Baselayout

* ะฃะฝะธัะธัะธัะพะฒะฐะฝะฝัะน ะฟะพะดัะพะด ะบ ะทะฐะฟััะบั
   - nodetach
   - tarantoolctl (local)
   - init.d
   - systemd

* ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน (sandbox)

???

# ะกะฑะพัะบะฐ RPM

---

# Baselayout

* ะฃะฝะธัะธัะธัะพะฒะฐะฝะฝัะน ะฟะพะดัะพะด ะบ ะทะฐะฟััะบั
   - nodetach
   - tarantoolctl (local)
   - init.d
   - systemd

* ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน (sandbox)

* ะกะฑะพัะบะฐ ะฟะฐะบะตัะพะฒ

???

# ะะฐะบ ะบ ััะพะผั ะฟัะธัะปะธ?
# ะะพะดัะพะด 1.5

---

# ะะพะดัะพะด "1.5"

> /etc/tarantool/instances.enabled/myapp.lua:

```nohighlight
box.cfg{
   ...
}

dofile "/usr/share/myapp/init.lua"
```

???

## ััะฐััะปะธะฒัะต ะปัะดะธ โ ะฝะต ะฒะธะดะตะปะธ 1.5
<br/>

# ะัะพะฑะปะตะผั
## ะะตั ะบะพะฝััะพะปั ะทะฐ `box.cfg`
## ะบะพะฝัะธะณ ะฟัะธะปะพะถะตะฝะธั?

---

# ะะพะดัะพะด "1.5"

> /etc/tarantool/instances.enabled/myapp.lua:

```nohighlight
box.cfg{
   ...
}

dofile "/usr/share/myapp/init.lua"
```

* ะะตั ะบะพะฝััะพะปั ะทะฐ `box.cfg` ัะพ ััะพัะพะฝั ะฟัะธะปะพะถะตะฝะธั
* ะะดะต ััะฐะฝะธัั ะบะพะฝัะธะณ ะฟัะธะปะพะถะตะฝะธั?

???

# ะะพะดัะพะด 1.6
# ะฟัะธะปะพะถะตะฝะธะต ะฒ /etc

---

# ะะพะดัะพะด "1.6"

> /etc/tarantool/instances.enabled/myapp.lua:

```nohighlight
myapp...

box.cfg{
   ...
}

myapp...
```

???

# ะัะพะฑะปะตะผั:
## ะะพะด ะฒ etc
## ะะพััะฐะฒะบะฐ ะบะพะดะฐ ะฟะฐะบะตัะพะผ?
## ะะดะต ััะฐะฝะธัั ะบะพะฝัะธะณ ะฟัะธะปะพะถะตะฝะธั?

---

# ะะพะดัะพะด "1.6"

> /etc/tarantool/instances.enabled/myapp.lua:

```nohighlight
myapp...

box.cfg{
   ...
}

myapp...
```

* ะะพะด ะฒ etc

* ะะพััะฐะฒะบะฐ ะบะพะดะฐ ะฟะฐะบะตัะพะผ?

* ะะดะต ััะฐะฝะธัั ะบะพะฝัะธะณ ะฟัะธะปะพะถะตะฝะธั?

???

# baselayout:
## ะฟัะธะปะพะถะตะฝะธะต ะฒ /usr/share

---

# ะะพะดัะพะด baselayout: application

```nohighight
/usr/share/myapp/
โโโ `init.lua`
โโโ app
โยย โโโ myapp
โยย โยย โโโ api
โยย โยย โยย โโโ ...
โยย โยย โโโ db
โยย โยย  ยย โโโ scheme.lua
โยย โยย  ยย โโโ triggers.lua
โยย โโโ myapp.lua
โโโ libs
    โโโ lib64
    โยย โโโ lua
    โยย โยย โโโ 5.1
    โยย โยย     โโโ ...
```

???

# baselayout:
## ะบะพะฝัะธะณะธ ะฒ /etc

---

# Baselayout: config

```nohighlight
/etc/tarantool/
โโโ instances.available
    โโโ myapp_01.lua -> /usr/share/myapp/init.lua
    โโโ myapp_02.lua -> /usr/share/myapp/init.lua
    โโโ example.lua

/etc/myapp/
โโโ conf.lua
```

???

# Baselayout: ะฝะฐัะธะฝะบะฐ
## init.lua

---

# Baselayout: init.lua

???

# ะะตะทะพะปะฒะธะฝะณ ะพะบััะถะตะฝะธั (nodetach, ctl, ...)

---

# Baselayout: init.lua

* ะะตะทะพะปะฒะธะฝะณ ะพะบััะถะตะฝะธั (nodetach, ctl, ...)

???

# ะะฟัะตะดะตะปะตะฝะธะต ะธะผะตะฝะธ ะธะฝััะฐะฝัะฐ

---

# Baselayout: init.lua

* ะะตะทะพะปะฒะธะฝะณ ะพะบััะถะตะฝะธั (nodetach, ctl, ...)

* ะะฟัะตะดะตะปะตะฝะธะต ะธะผะตะฝะธ ะธะฝััะฐะฝัะฐ

???

# ะะพะธัะบ ะบะพะฝัะธะณะฐ (/etc ะธะปะธ ./etc)

---

# Baselayout: init.lua

* ะะตะทะพะปะฒะธะฝะณ ะพะบััะถะตะฝะธั (nodetach, ctl, ...)

* ะะฟัะตะดะตะปะตะฝะธะต ะธะผะตะฝะธ ะธะฝััะฐะฝัะฐ

* ะะพะธัะบ ะบะพะฝัะธะณะฐ (/etc ะธะปะธ ./etc)

???

# package.path: ะปะพะบะฐะปัะฝัะต ะปะธะฑั
# sandbox

---

# Baselayout: init.lua

* ะะตะทะพะปะฒะธะฝะณ ะพะบััะถะตะฝะธั (nodetach, ctl, ...)

* ะะฟัะตะดะตะปะตะฝะธะต ะธะผะตะฝะธ ะธะฝััะฐะฝัะฐ

* ะะพะธัะบ ะบะพะฝัะธะณะฐ (/etc ะธะปะธ ./etc)

* ะฃััะฐะฝะพะฒะบะฐ `package.path` ะธ `package.cpath`

???

# ะพะฑัะทะฐัะตะปัะฝัะต ะผะพะดัะปะธ
## config
## package.reload
## kit

---

# Baselayout: init.lua

* ะะตะทะพะปะฒะธะฝะณ ะพะบััะถะตะฝะธั (nodetach, ctl, ...)

* ะะฟัะตะดะตะปะตะฝะธะต ะธะผะตะฝะธ ะธะฝััะฐะฝัะฐ

* ะะพะธัะบ ะบะพะฝัะธะณะฐ (/etc ะธะปะธ ./etc)

* ะฃััะฐะฝะพะฒะบะฐ `package.path` ะธ `package.cpath`

* ะะพะดะบะปััะตะฝะธะต ะพะฑัะทะฐัะตะปัะฝะพะณะพ ะฝะฐะฑะพัะฐ ะผะพะดัะปะตะน

   - config
   - package.reload
   - kit

???

# config: ะทะฐะดัะผัะฒะฐะปะพัั

---

# config: ะทะฐะดัะผัะฒะฐะปะพัั

* ะะฐะณััะทะบะฐ ะบะพะฝัะธะณะฐ ะธะท /etc

.width90.margin-auto[
> /etc/myapp/conf.lua:

```nohighlight
box = {
   background = true,
   work_dir   = "/var/lib/tarantool/myapp",
   ...
}
app = {
   param = "value",
}
```
]


* ะัะทะพะฒ `box.cfg` ั ะฟะฐัะฐะผะตััะฐะผะธ ะธะท ัะตะบัะธะธ `box`

* ะะตัะพะด ะดะปั ะฟะพะปััะตะฝะธั ะฟะฐัะฐะผะตััะพะฒ ะธะท Lua: `config.get`

???

# ะฐ ะฝะฐ ัะฐะผะพะผ ะดะตะปะต ะฟะพะปััะธะปะพัั

---

# config: ะฟะพะปััะธะปะพัั

???

# ะะฐะณััะทะบะฐ ะบะพะฝัะธะณะฐ ะธะท /etc

---

# config: ะฟะพะปััะธะปะพัั

* ะะฐะณััะทะบะฐ ะบะพะฝัะธะณะฐ ะธะท /etc

???

# ะะฐะณััะทะบะฐ ะบะพะฝัะธะณะฐ ะธะท etcd, ะตัะปะธ ัะบะฐะทะฐะฝะพ

---

# config: ะฟะพะปััะธะปะพัั

* ะะฐะณััะทะบะฐ ะบะพะฝัะธะณะฐ ะธะท /etc

* ะะฐะณััะทะบะฐ ะบะพะฝัะธะณะฐ ะธะท etcd, ะตัะปะธ ัะบะฐะทะฐะฝะพ

* ะะตัะถ ะบะพะฝัะธะณะพะฒ

???

# ะะฐะปะธะดะฐัะธั ะฟะฐัะฐะผะตััะพะฒ ะฟะพะด ะฒะตััะธั


---

# config: ะฟะพะปััะธะปะพัั

* ะะฐะณััะทะบะฐ ะบะพะฝัะธะณะฐ ะธะท /etc

* ะะฐะณััะทะบะฐ ะบะพะฝัะธะณะฐ ะธะท etcd, ะตัะปะธ ัะบะฐะทะฐะฝะพ

* ะะตัะถ ะบะพะฝัะธะณะพะฒ

* ะะฐะปะธะดะฐัะธั ะฟะฐัะฐะผะตััะพะฒ

???

# ะทะฐะฟััะบ ะธะปะธ ัะตะปะพะฐะด

---

# config: ะฟะพะปััะธะปะพัั

* ะะฐะณััะทะบะฐ ะบะพะฝัะธะณะฐ ะธะท /etc

* ะะฐะณััะทะบะฐ ะบะพะฝัะธะณะฐ ะธะท etcd, ะตัะปะธ ัะบะฐะทะฐะฝะพ

* ะะตัะถ ะบะพะฝัะธะณะพะฒ

* ะะฐะปะธะดะฐัะธั ะฟะฐัะฐะผะตััะพะฒ

* ะะฟัะตะดะตะปะตะฝะธะต ัะฐะทั (ะทะฐะฟััะบ ะธะปะธ ัะตะปะพะฐะด)

???

# ัะพะปั: ะผะฐััะตั/ัะตะฟะปะธะบะฐ
# ัะฟะธัะพะบ ัะตะฟะปะธะบ

---

# config: ะฟะพะปััะธะปะพัั

* ะะฐะณััะทะบะฐ ะบะพะฝัะธะณะฐ ะธะท /etc

* ะะฐะณััะทะบะฐ ะบะพะฝัะธะณะฐ ะธะท etcd, ะตัะปะธ ัะบะฐะทะฐะฝะพ

* ะะตัะถ ะบะพะฝัะธะณะพะฒ

* ะะฐะปะธะดะฐัะธั ะฟะฐัะฐะผะตััะพะฒ

* ะะฟัะตะดะตะปะตะฝะธะต ัะฐะทั (ะทะฐะฟััะบ ะธะปะธ ัะตะปะพะฐะด)

* ะะฟัะตะดะตะปะตะฝะธะต ัะฟะธัะบะฐ ัะตะฟะปะธะบ ะธ ัะพะปะธ (ro/rw)

???

# ะะพัะบััะฐัะฝะดั ัะบัะฟะปัะฐัะฐัะธะพะฝะฝัั ะฟัะพะฑะปะตะผ

---

# config: ะฟะพะปััะธะปะพัั

* ะะฐะณััะทะบะฐ ะบะพะฝัะธะณะฐ ะธะท /etc

* ะะฐะณััะทะบะฐ ะบะพะฝัะธะณะฐ ะธะท etcd, ะตัะปะธ ัะบะฐะทะฐะฝะพ

* ะะตัะถ ะบะพะฝัะธะณะพะฒ

* ะะฐะปะธะดะฐัะธั ะฟะฐัะฐะผะตััะพะฒ

* ะะฟัะตะดะตะปะตะฝะธะต ัะฐะทั (ะทะฐะฟััะบ ะธะปะธ ัะตะปะพะฐะด)

* ะะฟัะตะดะตะปะตะฝะธะต ัะฟะธัะบะฐ ัะตะฟะปะธะบ ะธ ัะพะปะธ (ro/rw)

* ะะพัะบััะฐัะฝะดั ัะบัะฟะปัะฐัะฐัะธะพะฝะฝัั ะฟัะพะฑะปะตะผ

???

# ะฟัะธะผะตั ะฟัะพะฑะปะตะผั
# ัะตััะฐัั ะผะฐััะตัะฐ
# ัะฐะฑะพัะฐัั ะผะฐััะตั + ัะตะฟะปะธะบะฐ

---

# ะัะพะฑะปะตะผะฐ ัะตััะฐััะฐ ะผะฐััะตัะฐ

.width70.margin-auto[
```nohighlight
           
           
M..........
           
           
           

R..........
           
           

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ>
                                                  t
```
]

???

# ะผะฐััะตั ัะตััะฐััะธััั
# ััะฐัััะตั
# ะทะฐะณััะถะฐะตั ัะฝะฐะฟัะพั

---

# ะัะพะฑะปะตะผะฐ ัะตััะฐััะฐ ะผะฐััะตัะฐ

.width70.margin-auto[
```nohighlight
           ะผะฐััะตั ัะฟะฐะป
           โผ
M..........X.cfg/rw...
              
              
              

R.....................
                      
                      

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ>
                                                  t
```
]

???

# ััะพ ะดะพะปะณะพ

---

# ะัะพะฑะปะตะผะฐ ัะตััะฐััะฐ ะผะฐััะตัะฐ

.width70.margin-auto[
```nohighlight
           ะผะฐััะตั ัะฟะฐะป
           โผ
M..........X.cfg/rw...............up
              โโโโโโโโโโโฌโโโโโโโโโโ
                    ะทะฐะณััะทะบะฐ
                   ~ 5Gb/min

R...................................
                        
                        

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ>
                                                  t
```
]

???

# ะฐะดะผะธะฝ ะธะปะธ ะฐะฒัะพะผะฐัะธะบะฐ
# ะฟะตัะตะบะปััะฐั ะผะฐััะตั


---

# ะัะพะฑะปะตะผะฐ ัะตััะฐััะฐ ะผะฐััะตัะฐ

.width70.margin-auto[
```nohighlight
           ะผะฐััะตั ัะฟะฐะป
           โผ
M..........X.cfg/rw...............up
              โโโโโโโโโโโฌโโโโโโโโโโ
                    ะทะฐะณััะทะบะฐ
                   ~ 5Gb/min

R.......................M...........
                        โฒ
                        ะฐะดะผะธะฝ ะฟะตัะตะบะปััะธะป

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ>
                                                  t
```
]

???

# ะทะฐะณััะทะบะฐ ะฟัะพะดะพะปะถะธะปะฐัั
# rw
# 2 ะผะฐััะตัะฐ

---

# ะัะพะฑะปะตะผะฐ ัะตััะฐััะฐ ะผะฐััะตัะฐ

.width70.margin-auto.not[
```nohighlight
           ะผะฐััะตั ัะฟะฐะป               ะฒัะพัะพะน ะผะฐััะตั
           โผ                         โผ
M..........X.cfg/rw.............up/rw`.`
              โโโโโโโโโโโฌโโโโโโโโโโ
                    ะทะฐะณััะทะบะฐ
                   ~ 5Gb/min

R.......................M............`.`
                        โฒ
                        ะฐะดะผะธะฝ ะฟะตัะตะบะปััะธะป

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ>
                                                  t
```
]

???

# ะบะพะฝัะธะณ:
# ะทะฐะฒะพัะบััะฐัะฝะดะธะผ

---

# config. ะฒะพัะบััะฐัะฝะดั ัะบัะฟะปัะฐัะฐัะธะพะฝะฝัั ะฟัะพะฑะปะตะผ

* ะะตััะฐัั ะผะฐััะตัะฐ
   - ะะฐะฟััะบ `box.cfg{ ..., readonly=true }`
   - ะะตัะตัะธััะฒะฐะฝะธะต ะบะพะฝัะธะณะฐ
   - ะัะทะพะฒ `box.cfg{ readonly=false }` (ะตัะปะธ ััะตะฑัะตััั)

???

# ะะตััะฐัั ัะตะฟะปะธะบะฐัะธะธ ะฟัะธ ัะตะปะพะฐะดะต

---

# config. ะฒะพัะบััะฐัะฝะดั ัะบัะฟะปัะฐัะฐัะธะพะฝะฝัั ะฟัะพะฑะปะตะผ

* ะะตััะฐัั ะผะฐััะตัะฐ
   - ะะฐะฟััะบ `box.cfg{ ..., readonly=true }`
   - ะะตัะตัะธััะฒะฐะฝะธะต ะบะพะฝัะธะณะฐ
   - ะัะทะพะฒ `box.cfg{ readonly=false }` (ะตัะปะธ ััะตะฑัะตััั)

* ะะตััะฐัั ัะตะฟะปะธะบะฐัะธะธ ะฟัะธ ัะตะปะพะฐะดะต
   - ะะฐะปะธะดะฐัะธั ัะฟะธัะบะฐ ัะตะฟะปะธะบ ะฟัะธ ัะตะปะพะฐะดะต
   - ะกะฒะตัะบะฐ ัะตะบััะตะณะพ ะทะฝะฐัะตะฝะธั ั ะบะพะฝัะธะณะพะผ

???

# ะัะพะฑะปะตะผั ะทะฐะฟััะบะฐ ะผัะปััะธะผะฐััะตัะฐ
# default: RO

---

# config. ะฒะพัะบััะฐัะฝะดั ัะบัะฟะปัะฐัะฐัะธะพะฝะฝัั ะฟัะพะฑะปะตะผ

* ะะตััะฐัั ะผะฐััะตัะฐ
   - ะะฐะฟััะบ `box.cfg{ ..., readonly=true }`
   - ะะตัะตัะธััะฒะฐะฝะธะต ะบะพะฝัะธะณะฐ
   - ะัะทะพะฒ `box.cfg{ readonly=false }` (ะตัะปะธ ััะตะฑัะตััั)

* ะะตััะฐัั ัะตะฟะปะธะบะฐัะธะธ ะฟัะธ ัะตะปะพะฐะดะต
   - ะะฐะปะธะดะฐัะธั ัะฟะธัะบะฐ ัะตะฟะปะธะบ ะฟัะธ ัะตะปะพะฐะดะต
   - ะกะฒะตัะบะฐ ัะตะบััะตะณะพ ะทะฝะฐัะตะฝะธะต ั ะบะพะฝัะธะณะพะผ

* ะัะพะฑะปะตะผั ะทะฐะฟััะบะฐ ะผัะปััะธะผะฐััะตัะฐ
   - ะะฐะฟััะบ ะฑะตะท ะฟะฐัะฐะผะตััะฐ ะฟะพ ัะผะพะปัะฐะฝะธั ะฒ readonly

???

# ะผััะฐะฝั

---
class: image-full

![](style/aeromunculus-crop.jpg)

???

# ะะตัะตะทะฐะณััะทะบะฐ ะบะพะดะฐ

---

# ะะตัะตะทะฐะณััะทะบะฐ ะบะพะดะฐ: `package.reload`

```lua
...
require 'package.reload'
...
```

* ะะฐะฟะพะผะธะฝะฐะตั ะทะฐะณััะถะตะฝะฝัะต ะฟะฐะบะตัั

* ะัะธ ะฟะพะฒัะพัะฝะพะน ะทะฐะณััะทะบะต ะพัะธัะฐะตั `package.loaded`

* ะกัะธัะฐะตั ะฟะตัะตะทะฐะณััะทะบะธ

* ะะผะตะตั ะธะฝัะตััะตะนั ะดะปั ัะตะณะธัััะฐัะธะธ ะบะพะปะปะฑัะบะฐ ะฝะฐ ัะตะปะพะฐะด

* ะะตัะตะทะฐะณััะทะบะฐ ะบะพะผะฐะฝะดะพะน `package.reload()`<br>(ะฒะผะตััะพ `dofile "/path/to/init.lua"`)

```lua
tarantool> package.reload()
```

???

# ะพะฑัะฐัะฝะฐั ัะพะฒะผะตััะธะผะพััั

---

# ะะฑัะฐัะฝะฐั ัะพะฒะผะตััะธะผะพััั

.center[
# 1.6 โ 1.7 โ 1.9 โ 1.10 โ 1.10.2 โ 1.10.3 โ 2.0 โ 2.1
]

???

# ะฟัะฐะฒะธะปัะฝัะน ัะธะผะฒะพะป

---

# ะะฑัะฐัะฝะฐั ัะพะฒะผะตััะธะผะพััั

.center[
# 1.6 ๐ฉ 1.7 ๐ฉ 1.9 ๐ฉ 1.10 ๐ฉ 1.10.2 ๐ฉ 1.10.3 ๐ฉ 2.0 ๐ฉ 2.1
]

???

# box.info

---

# ะะฑัะฐัะฝะฐั ัะพะฒะผะตััะธะผะพััั

.center[
# 1.6 โ 1.7 โ 1.9 โ 1.10 โ 1.10.2 โ 1.10.3 โ 2.0 โ 2.1
]

* `box.info.server.ro` vs `box.info.ro`

* `box.info.server.*`: `lsn`, `id`, `uuid`

* `wait_lsn`

* `schema_version`

* &hellip;

???

# kit: ะพะฑะพะฑััะฝะฝัะน ะธะฝัะตััะตะนั

---

# kit: ะพะฑะพะฑััะฝะฝัะน ะธะฝัะตััะตะนั

```lua
require 'kit'
```

```nohighlight
tarantool> kit.node()
---
- id: 1
  uuid: 1457a4ce-0001-0001-0000-000000000000
  lsn: 8120720
  ro: false
  rw: true
  hostname: my.hostname.com
...
```


???

# ััะฝะบัะธะธ ะธะท ะฝะพะฒัั ะฒะตััะธะน

---

# kit: ะพะฑัะฐัะฝะฐั ัะพะฒะผะตััะธะผะพััั

* `kit.wait_lsn(node_id, lsn [,timeout])`

* `table.new`, `table.clear`

* `box.NULL` without box.cfg

* `kit.schema_version`

???

# ะบะฐะบ ัะดะตะปะฐะฝะพ

---

# kit: ััััะพะนััะฒะพ

```nohighlight
โโโ kit.lua
โโโ kit
 ยย โโโ 1
 ยย โยย โโโ 10.lua
 ยย โยย โโโ 5
 ยย โยย โยย โโโ fiber.lua
 ยย โยย โยย โโโ init.lua
 ยย โยย โโโ 6
 ยย โยย โยย โโโ 0.lua
 ยย โยย โโโ 6+.lua
 ยย โยย โโโ 6.lua
 ยย โยย โโโ 7.lua
 ยย โยย โโโ 9.lua
 ยย โโโ 1.lua
 ยย โโโ loc.lua
```

???

# ะฟะพััะดะพะบ ะทะฐะณััะทะบะธ

---

# kit: ััััะพะนััะฒะพ

## 1.10.2-203-g0b7078a

* kit/1.lua

* kit/1/10.lua

* kit/1/10/2.lua

* kit/1/10/2-203-g0b7078a.lua

???

# ััะพ ะตัั ะผั ะธัะฟะพะปัะทัะตะผ?

---

# ะงัะพ ะตัั?

* moonlibs/tarantoolapp โ ะณะตะฝะตัะฐัะพั ัะฐะฑะปะพะฝะฐ ะฟัะธะปะพะถะตะฝะธั

* igorcoding/spacer (v1) โ ะดะตะบะปะฐัะฐัะธะฒะฝะพะต ะพะฟะธัะฐะฝะธะต ัะฟะตะนัะพะฒ

* igorcoding/spacer (v2) โ + ะผะธะณัะฐัะพั ััะตะผั

* tarantool/moonwalker โ ะพะฑัะพะด ัะฟะตะนัะฐ

* moonlibs/xqueue โ ะผะพะดัะปั ะดะปั ะพัะตัะตะดะตะน

* moonlibs/apex โ ัะฝะธะฒะตััะฐะปัะฝะฐั ะฟัะพะบัะธ

???

# ะะฐะบ ะฟะพะฟัะพะฑะพะฒะฐัั?

---

# ะะฐะบ ะฟะพะฟัะพะฑะพะฒะฐัั?

## github.com/moonlibs/baselayout
## github.com/moonlibs/tarantoolapp



---
class:first
layout:false

.absolute.left10.right30.top8[

# ะะพะฟัะพัั?

#### http://github.com/tarantool<br>http://github.com/moonlibs

## Mons Anderson
## Mail.ru Cloud Solutions
]
